services:
  proxy:
    image: nginx:alpine
    ports:
      - 80:80   
      - 443:443
      
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./conf.d/:/etc/nginx/conf.d/
      
      - /mnt/md0/data/letsencrypt/:/etc/letsencrypt/

    depends_on:
        - site
        - qlub
  
  site:
    image: njavilas/qlub:site

    volumes:
      - /mnt/md0/data/letsencrypt/live/npm-42/fullchain.pem:/etc/letsencrypt/fullchain.pem
      - /mnt/md0/data/letsencrypt/live/npm-42/privkey.pem:/etc/letsencrypt/privkey.pem

    expose:
      - 443

  qlub:
    image: njavilas/qlub:server
    volumes:
      - ./subdomains.json:/app/subdomains.json
      - ./nginx.conf:/app/nginx.conf
      - ./conf.d/:/app/conf.d/